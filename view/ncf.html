{include="header"}

<script type="text/javascript">
    function delete_datos_solicitud(url)
    {
        if (confirm("¿Realmente desea eliminar estos datos de la solicitud?"))
            window.location.href = url;
    }
    $(document).ready(function () {
        $("#b_nueva_solicitud_ncf").click(function (event) {
            event.preventDefault();
            $("#modal_nueva_solicitud").modal('show');
            document.f_nueva_solicitud_ncf.solicitud.focus();
        });
    });
</script>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-12">
            <div class="page-header">
                <h1>
                    Maestro de NCF
                    <a class="btn btn-xs btn-default" href="{$fsc->url()}" title="Recargar la página">
                        <span class="glyphicon glyphicon-refresh"></span>
                    </a>
                    <span class="btn-group">
                        <a id="b_nueva_solicitud_ncf" class="btn btn-xs btn-success" href="#">
                            <span class="glyphicon glyphicon-plus"></span>
                            <span class="hidden-xs">&nbsp; Ingresar Nueva Solicitud</span>
                        </a>
                        {loop="$fsc->extensions"}
                        {if="$value->type=='button'"}
                        <a href="index.php?page={$value->from}{$value->params}" class="btn btn-xs btn-default">{$value->text}</a>
                        {/if}
                        {/loop}
                    </span>
                </h1>
                <p class="help-block">
                    Se debe registrar en esta página la lista de Solicitudes de NCF autorizadas por DGII en República Dominicana,
                    si este no es su país, por favor revise su configuración ya que se activará información para este pais. 
                    <a href="index.php?page=admin_empresa#facturacion">Ir a configuración de la empresa</a>.
                </p>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <br/>
        </div>
    </div>
    {loop="$fsc->ncf_rango->all($fsc->empresa->id)"}
    <div class="row">
        <div class="col-sm-12">
            <form class="form" role="form" action="{$fsc->url()}" method="post">
                <input type="hidden" name="solicitud" value="{$value->solicitud}"/>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Solicitud: {$value->solicitud}</h3>
                    </div>
                    <div class="panel-body">
                        <div class="container-fluid">
                            <div class="row">

                                <div class="col-sm-1">
                                    <div class="form-group">
                                        <a href="{$fsc->almacen->url()}">Almacen</a>
                                        <select name="codalmacen" class="form-control">
                                            {loop="$fsc->almacen->all()"}
                                            {if="$value1->codalmacen==$value2->codalmacen"}
                                            <option value="{$value2->codalmacen}" selected="">{$value2->nombre}</option>
                                            {else}
                                            <option value="{$value2->codalmacen}">{$value2->nombre}</option>
                                            {/if}
                                            {/loop}
                                        </select>
                                    </div>
                                </div> 
                                <div class="col-sm-1">
                                    <div class="form-group">
                                        Serie:
                                        <select name="serie" class="form-control">
                                            {loop="$fsc->array_series"}
                                            {if="$value1->serie==$value2[0]"}
                                            <option value="{$value2[0]}" selected="">{$value2[0]}</option>
                                            {else}
                                            <option value="{$value2[0]}">{$value2[0]}</option>
                                            {/if}
                                            {/loop}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-1">
                                    <div class="form-group">
                                        División:
                                        <input class="form-control" type="number" name="division" min="1" max="999" value="{$value->division}" autocomplete="off"/>
                                    </div>
                                </div>
                                <div class="col-lg-1 col-md-1 col-sm-1">
                                    <div class="form-group">
                                        Pto Emi:
                                        <input class="form-control" type="number" name="punto_emision" min="1" max="999" value="{$value->punto_emision}" autocomplete="off"/>
                                    </div>
                                </div>
                                <div class="col-sm-1">
                                    <div class="form-group">
                                        Area Imp:
                                        <input class="form-control" type="number" name="area_impresion" min="1" max="999" value="{$value->area_impresion}" autocomplete="off"/>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        Tipo Comprob:
                                        <select name="tipo_comprobante" class="form-control">
                                            {loop="$fsc->ncf_tipo->all()"}
                                            {if="$value1->tipo_comprobante==$value2->tipo_comprobante"}
                                            <option value="{$value2->tipo_comprobante}" selected="">{$value2->tipo_comprobante} - {$value2->descripcion}</option>
                                            {else}
                                            <option value="{$value2->tipo_comprobante}">{$value2->tipo_comprobante} - {$value2->descripcion}</option>
                                            {/if}
                                            {/loop}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-1">
                                    <div class="form-group">
                                        Inicia:
                                        <input class="form-control" type="number" name="secuencia_inicio" min="1" max="99999999" value="{$value->secuencia_inicio}" autocomplete="off"/>
                                    </div>
                                </div>
                                <div class="col-sm-1">
                                    <div class="form-group">
                                        Fin:
                                        <input class="form-control" type="number" name="secuencia_fin" min="1" max="99999999" value="{$value->secuencia_fin}" autocomplete="off"/>
                                    </div>
                                </div>
                                <div class="col-sm-1">
                                    <div class="form-group">
                                        Correlativo:
                                        <input class="form-control" type="number" name="correlativo" min="1" max="99999999" value="{$value->correlativo}" autocomplete="off"/>
                                    </div>
                                </div>
                                <div class="col-sm-1">
                                    <div class="form-group">
                                        <br/>
                                        {if="$fsc->allow_delete"}
                                        {if="$value->correlativo>1"}
                                        <a class="btn btn-sm btn-warning pull-left" onclick="alert('No puedes eliminar esta información porque ya esta en uso.')">
                                            <span class="glyphicon glyphicon-lock"></span>
                                        </a>  
                                        {else}
                                        <a class="btn btn-sm btn-danger pull-left" onclick="delete_datos_solicitud('{$fsc->url()}&delete={$value->solicitud}-{$value->codalmacen}-{$value->serie}-{$value->division}-{$value->punto_emision}-{$value->area_impresion}-{$value->tipo_comprobante}-{$value->secuencia_inicio}-{$value->correlativo}')">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </a>  
                                        {/if}
                                        {/if}
                                        <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true; this.form.submit();">
                                            <span class="glyphicon glyphicon-floppy-disk"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    {else}
    <div class="row">
        <div class="col-sm-12">
            <div class="alert alert-danger">Ninguna solicitud de NCF registrada.</div>
        </div>
    </div>
    {/loop}
</div>

<div class="modal" id="modal_nueva_solicitud">
    <div class="modal-dialog">
        <div class="modal-content">
            <form name="f_nueva_solicitud_ncf" action="{$fsc->url()}" method="post" class="form-horizontal" role="form">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Nueva Solicitud de NCF</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Solicitud:</label>
                        <div class="col-sm-8">
                            <input class="form-control" type="text" name="solicitud" maxlength="4" autocomplete="off"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">
                            <a href="{$fsc->almacen->url()}">Almacén</a>:
                        </label>
                        <div class="col-sm-8">
                            <select name="codalmacen" class="form-control">
                                {loop="$fsc->almacen->all()"}
                                <option value="{$value->codalmacen}"{if="$value->is_default()"} selected=""{/if}>{$value->nombre}</option>
                                {/loop}
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Serie: (A - U)</label>
                        <div class="col-sm-8">
                            <select name="serie" class="form-control">
                                {loop="$fsc->array_series"}
                                <option value="{$value[0]}">{$value[0]}</option>
                                {/loop}
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">División: (00)</label>
                        <div class="col-sm-8">
                            <input class="form-control" type="number" name="division" min="1" max="99" autocomplete="off"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Punto de emisión: (000)</label>
                        <div class="col-sm-8">
                            <input class="form-control" type="number" name="punto_emision" min="1" max="999" autocomplete="off"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Area de impresión: (000)</label>
                        <div class="col-sm-8">
                            <input class="form-control" type="number" name="area_impresion" min="1" max="999" autocomplete="off"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Tipo Comprobante: (00)</label>
                        <div class="col-sm-8">
                            <select name="tipo_comprobante" class="form-control">
                                {loop="$fsc->ncf_tipo->all()"}
                                <option value="{$value->tipo_comprobante}">{$value->tipo_comprobante} - {$value->descripcion}</option>
                                {/loop}
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Secuencia Inicio:</label>
                        <div class="col-sm-8">
                            <input class="form-control" type="number" name="secuencia_inicio" min="1" max="99999999" autocomplete="off"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Secuencia Fin:</label>
                        <div class="col-sm-8">
                            <input class="form-control" type="number" name="secuencia_fin" min="1" max="99999999" autocomplete="off"/>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-sm btn-primary" type="submit" onclick="this.disabled = true;
                       this.form.submit();">
                        <span class="glyphicon glyphicon-floppy-disk"></span> &nbsp; Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{include="footer"}